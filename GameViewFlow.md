# GameView ç‰©ä»¶å»ºç«‹æµç¨‹è©³è§£

> Documentationï¼šå¾ XML åˆ°ç‰©ä»¶çš„å®Œæ•´å»ºç«‹æµç¨‹
> Authorï¼šYork Lai
> Last Updatedï¼š2025/12/08

---

## ğŸ“– ç›®éŒ„

1. [æ¦‚è¿°èˆ‡å®Œæ•´æµç¨‹åœ–](#æ¦‚è¿°èˆ‡å®Œæ•´æµç¨‹åœ–)
2. [ç¨‹å¼ç¢¼åƒè€ƒ](#ç¨‹å¼ç¢¼åƒè€ƒ)
3. [éšæ®µ 1ï¼šé¡åˆ¥è¼‰å…¥ (Class Loading)](#éšæ®µ-1é¡åˆ¥è¼‰å…¥-class-loading)
4. [éšæ®µ 2ï¼šç‰©ä»¶å»ºç«‹ (Object Creation)](#éšæ®µ-2ç‰©ä»¶å»ºç«‹-object-creation)
5. [éšæ®µ 3ï¼šView ç”Ÿå‘½é€±æœŸ](#éšæ®µ-3view-ç”Ÿå‘½é€±æœŸ)
6. [éšæ®µ 4ï¼šå‹•ç•«å¾ªç’°](#éšæ®µ-4å‹•ç•«å¾ªç’°)
7. [å®Œæ•´ç²¾ç´°æµç¨‹åœ–](#å®Œæ•´ç²¾ç´°æµç¨‹åœ–)
8. [é—œéµæ¦‚å¿µèªªæ˜](#é—œéµæ¦‚å¿µèªªæ˜)

---

## æ¦‚è¿°èˆ‡å®Œæ•´æµç¨‹åœ–

### ğŸ“ èµ·é»èˆ‡çµ‚é»

**èµ·é»**ï¼š`MainActivity.onCreate()` â†’ `setContentView(R.layout.activity_main)`

**çµ‚é»**ï¼šGameView ç‰©ä»¶å»ºç«‹å®Œæˆ â†’ åŠ å…¥ View æ¨¹ â†’ é–‹å§‹å‹•ç•«å¾ªç’°

---

### ğŸ¬ å®Œæ•´æµç¨‹ç¸½è¦½ï¼ˆå››å¤§éšæ®µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšæ®µ 1ï¼šé¡åˆ¥è¼‰å…¥ (Class Loading)                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ MainActivity.onCreate()                                  â”‚
â”‚     â†“                                                    â”‚
â”‚ setContentView(R.layout.activity_main) â­ è§¸ç™¼é»         â”‚
â”‚     â†“                                                    â”‚
â”‚ ç³»çµ±è§£æ XML â†’ ç™¼ç¾ <com.example.firstapp.GameView>     â”‚
â”‚     â†“                                                    â”‚
â”‚ è¼‰å…¥ GameView.class                                      â”‚
â”‚     â”œâ”€ è™•ç† package å®£å‘Š                                 â”‚
â”‚     â”œâ”€ è™•ç† import é™³è¿°å¥                                â”‚
â”‚     â”œâ”€ è¼‰å…¥é¡åˆ¥å®šç¾© (extends View)                       â”‚
â”‚     â””â”€ è¼‰å…¥ä¾è³´é¡åˆ¥ (Context, Paint, Color...)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšæ®µ 2ï¼šç‰©ä»¶å»ºç«‹ (Object Creation)                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ new GameView(context, attrs) â† å‘¼å«å»ºæ§‹å­               â”‚
â”‚     â†“                                                    â”‚
â”‚ super(context, attrs) â†’ åˆå§‹åŒ– View åŸºç¤åŠŸèƒ½             â”‚
â”‚     â”œâ”€ æ¸¬é‡ç³»çµ± (Measure)                                â”‚
â”‚     â”œâ”€ ä½ˆå±€ç³»çµ± (Layout)                                 â”‚
â”‚     â”œâ”€ ç¹ªè£½ç³»çµ± (Draw)                                   â”‚
â”‚     â””â”€ è™•ç† XML å±¬æ€§ (id, width, height...)              â”‚
â”‚     â†“                                                    â”‚
â”‚ init() â†’ è‡ªè¨‚åˆå§‹åŒ–                                      â”‚
â”‚     â”œâ”€ carPaint = new Paint()                            â”‚
â”‚     â”œâ”€ carPaint.setColor(Color.RED)                      â”‚
â”‚     â””â”€ post(updateRunnable) â† è¨»å†Šå‹•ç•«ä»»å‹™               â”‚
â”‚     â†“                                                    â”‚
â”‚ GameView ç‰©ä»¶å»ºç«‹å®Œæˆ âœ“                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšæ®µ 3ï¼šView ç”Ÿå‘½é€±æœŸ                                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ åŠ å…¥ View æ¨¹                                             â”‚
â”‚     â†“                                                    â”‚
â”‚ onAttachedToWindow() â†’ View é™„åŠ åˆ°è¦–çª—                   â”‚
â”‚     â†“                                                    â”‚
â”‚ onMeasure() â†’ æ¸¬é‡ View å°ºå¯¸                             â”‚
â”‚     â†“                                                    â”‚
â”‚ onLayout() â†’ æ±ºå®š View ä½ç½®                              â”‚
â”‚     â†“                                                    â”‚
â”‚ View æº–å‚™å®Œæˆ â†’ é–‹å§‹åŸ·è¡Œ post() çš„ä»»å‹™                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšæ®µ 4ï¼šå‹•ç•«å¾ªç’° (Animation Loop)                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ updateRunnable.run()                                     â”‚
â”‚     â”œâ”€ update() â†’ æ›´æ–°éŠæˆ²é‚è¼¯                           â”‚
â”‚     â”œâ”€ invalidate() â†’ è¦æ±‚é‡ç¹ª â­                        â”‚
â”‚     â””â”€ postDelayed(this, 16) â†’ 16ms å¾Œå†åŸ·è¡Œ             â”‚
â”‚     â†“                                                    â”‚
â”‚ onDraw(canvas) â† invalidate() è§¸ç™¼                       â”‚
â”‚     â”œâ”€ canvas.drawColor() â†’ ç¹ªè£½èƒŒæ™¯                     â”‚
â”‚     â””â”€ canvas.drawRect() â†’ ç¹ªè£½è»Šå­                      â”‚
â”‚     â†“                                                    â”‚
â”‚ ç•«é¢æ›´æ–°å®Œæˆ                                             â”‚
â”‚     â†“                                                    â”‚
â”‚ 16ms å¾Œ â†’ å†æ¬¡åŸ·è¡Œ updateRunnable â†»                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¨‹å¼ç¢¼åƒè€ƒ

### ğŸ“„ GameView.java å®Œæ•´ç¨‹å¼ç¢¼

```java
package com.example.firstapp;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.util.AttributeSet;
import android.view.View;

public class GameView extends View {

    private Paint carPaint;
    private float carX, carY;
    private final float carWidth = 120f, carHeight = 200f;

    private final Runnable updateRunnable = new Runnable() {
        @Override
        public void run() {
            update();
            invalidate();
            postDelayed(this, 16);
        }
    };

    public GameView(Context context) {
        super(context);
        init();
    }

    public GameView(Context context, AttributeSet attrs) {
        super(context, attrs);
        init();
    }

    public GameView(Context context, AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        init();
    }

    private void init() {
        carPaint = new Paint();
        carPaint.setColor(Color.RED);
        post(updateRunnable);
    }

    private void update() {
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        canvas.drawColor(Color.rgb(50, 50, 50));
        canvas.drawRect(carX, carY, carX + carWidth, carY + carHeight, carPaint);
    }
}
```

### ğŸ“„ activity_main.xml

```xml
<androidx.constraintlayout.widget.ConstraintLayout
    android:id="@+id/main"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <com.example.firstapp.GameView
        android:id="@+id/gameView"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

### ğŸ“„ MainActivity.java

```java
public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);  // â† å¾é€™è£¡é–‹å§‹
    }
}
```

---

## éšæ®µ 1ï¼šé¡åˆ¥è¼‰å…¥ (Class Loading)

### ğŸ¯ è§¸ç™¼æ™‚æ©Ÿ

`setContentView(R.layout.activity_main)` åŸ·è¡Œæ™‚

---

### ğŸ“‹ è™•ç†å…§å®¹

#### æ­¥é©Ÿ 1.1ï¼šè§£æ package å®£å‘Š

```java
package com.example.firstapp;  // GameView.java ç¬¬ 1 è¡Œ
```

**è™•ç†å‹•ä½œ**ï¼š
- ç¢ºèªé¡åˆ¥çš„å®Œæ•´åç¨±ï¼š`com.example.firstapp.GameView`
- ç¢ºèªé¡åˆ¥ä½æ–¼ï¼š`com/example/firstapp/` ç›®éŒ„
- è¨»å†Šåˆ° JVM çš„å‘½åç©ºé–“

---

#### æ­¥é©Ÿ 1.2ï¼šè™•ç† import é™³è¿°å¥

```java
import android.content.Context;      // ç¬¬ 3 è¡Œ
import android.graphics.Canvas;      // ç¬¬ 4 è¡Œ
import android.graphics.Color;       // ç¬¬ 5 è¡Œ
import android.graphics.Paint;       // ç¬¬ 6 è¡Œ
import android.util.AttributeSet;    // ç¬¬ 7 è¡Œ
import android.view.View;            // ç¬¬ 8 è¡Œ
```

**è™•ç†å‹•ä½œ**ï¼š
- å»ºç«‹é¡åˆ¥åç¨±å°ç…§è¡¨ï¼š
  - `Context` â†’ `android.content.Context`
  - `Paint` â†’ `android.graphics.Paint`
  - `View` â†’ `android.view.View`
  - ç­‰ç­‰...

---

#### æ­¥é©Ÿ 1.3ï¼šè¼‰å…¥é¡åˆ¥å®šç¾©

```java
public class GameView extends View {  // ç¬¬ 10 è¡Œ
```

**è™•ç†å‹•ä½œ**ï¼š
1. è®€å–é¡åˆ¥åç¨±ï¼š`GameView`
2. ç¢ºèªçˆ¶é¡åˆ¥ï¼š`View`
3. è¼‰å…¥çˆ¶é¡åˆ¥ï¼š`android.view.View`
4. é©—è­‰ç¹¼æ‰¿é—œä¿‚åˆæ³•æ€§
5. å»ºç«‹é¡åˆ¥çµæ§‹

---

#### æ­¥é©Ÿ 1.4ï¼šè¼‰å…¥ä¾è³´é¡åˆ¥ï¼ˆæŒ‰éœ€è¼‰å…¥ï¼‰

| é¡åˆ¥ | è¼‰å…¥æ™‚æ©Ÿ | åŸå›  |
|------|---------|------|
| `View` | GameView è¼‰å…¥æ™‚ | çˆ¶é¡åˆ¥ï¼Œç«‹å³éœ€è¦ |
| `Context` | å»ºæ§‹å­å‘¼å«å‰ | å»ºæ§‹å­åƒæ•¸ |
| `AttributeSet` | å»ºæ§‹å­å‘¼å«å‰ | å»ºæ§‹å­åƒæ•¸ |
| `Paint` | init() åŸ·è¡Œå‰ | `new Paint()` æ™‚éœ€è¦ |
| `Color` | init() åŸ·è¡Œå‰ | `Color.RED` æ™‚éœ€è¦ |
| `Canvas` | onDraw() å‘¼å«å‰ | `onDraw(Canvas)` æ™‚éœ€è¦ |

---

### ğŸ“Š é¡åˆ¥è¼‰å…¥ vs ç‰©ä»¶å»ºç«‹

| éšæ®µ | æ™‚æ©Ÿ | æ¬¡æ•¸ | å‹•ä½œ |
|------|------|------|------|
| é¡åˆ¥è¼‰å…¥ | ç¬¬ä¸€æ¬¡ä½¿ç”¨è©²é¡åˆ¥ | åªç™¼ç”Ÿä¸€æ¬¡ | è™•ç† package, import, class å®šç¾© |
| ç‰©ä»¶å»ºç«‹ | æ¯æ¬¡ new æ™‚ | å¯å¤šæ¬¡ | å‘¼å«å»ºæ§‹å­ï¼Œåˆå§‹åŒ–æˆå“¡è®Šæ•¸ |

---

## éšæ®µ 2ï¼šç‰©ä»¶å»ºç«‹ (Object Creation)

### ğŸ¯ å»ºæ§‹å­é¸æ“‡é‚è¼¯

GameView æœ‰ä¸‰å€‹å»ºæ§‹å­ï¼š

```java
// å»ºæ§‹å­ 1ï¼šå–®åƒæ•¸ï¼ˆç¬¬ 24-27 è¡Œï¼‰
public GameView(Context context) {
    super(context);
    init();
}

// å»ºæ§‹å­ 2ï¼šé›™åƒæ•¸ï¼ˆç¬¬ 29-32 è¡Œï¼‰â­ XML è¼‰å…¥æ™‚ä½¿ç”¨é€™å€‹
public GameView(Context context, AttributeSet attrs) {
    super(context, attrs);
    init();
}

// å»ºæ§‹å­ 3ï¼šä¸‰åƒæ•¸ï¼ˆç¬¬ 34-37 è¡Œï¼‰
public GameView(Context context, AttributeSet attrs, int defStyleAttr) {
    super(context, attrs, defStyleAttr);
    init();
}
```

#### ä½¿ç”¨å ´æ™¯å°ç…§è¡¨

| å ´æ™¯ | å‘¼å«çš„å»ºæ§‹å­ | ç¯„ä¾‹ |
|------|-------------|------|
| ç¨‹å¼ç¢¼å»ºç«‹ | å»ºæ§‹å­ 1 | `new GameView(this)` |
| XML è¼‰å…¥ï¼ˆä¸€èˆ¬ï¼‰| å»ºæ§‹å­ 2 â­ | `<com.example.firstapp.GameView />` |
| XML è¼‰å…¥ï¼ˆæœ‰ styleï¼‰| å»ºæ§‹å­ 3 | `<GameView style="@style/MyStyle" />` |

**æœ¬å°ˆæ¡ˆæƒ…æ³**ï¼šå¾ XML è¼‰å…¥ï¼Œç„¡è‡ªè¨‚ style â†’ ä½¿ç”¨å»ºæ§‹å­ 2

---

### ğŸ“‹ å»ºæ§‹å­åŸ·è¡Œæµç¨‹

#### æ­¥é©Ÿ 2.1ï¼šå‘¼å«å»ºæ§‹å­

```java
// ç³»çµ±åŸ·è¡Œï¼š
new GameView(context, attrs)  // å»ºæ§‹å­ 2ï¼ˆç¬¬ 29 è¡Œï¼‰
```

**åƒæ•¸èªªæ˜**ï¼š
- `context`ï¼šMainActivity çš„ Context
- `attrs`ï¼šåŒ…å« XML ä¸­æ‰€æœ‰å±¬æ€§çš„é›†åˆï¼ˆid, width, height, constraints...ï¼‰

---

#### æ­¥é©Ÿ 2.2ï¼šåŸ·è¡Œ super(context, attrs)

```java
super(context, attrs);  // ç¬¬ 30 è¡Œ
```

**é€²å…¥ View é¡åˆ¥å»ºæ§‹å­ï¼ŒåŸ·è¡Œ**ï¼š
1. åˆå§‹åŒ– View åŸºç¤ç³»çµ±
   - æ¸¬é‡ç³»çµ±ï¼ˆMeasureï¼‰
   - ä½ˆå±€ç³»çµ±ï¼ˆLayoutï¼‰
   - ç¹ªè£½ç³»çµ±ï¼ˆDrawï¼‰
   - äº‹ä»¶åˆ†ç™¼ç³»çµ±ï¼ˆEventï¼‰

2. è™•ç† XML å±¬æ€§
   - `android:id="@+id/gameView"` â†’ è¨­å®š View ID
   - `android:layout_width="match_parent"` â†’ è¨­å®šå¯¬åº¦
   - `android:layout_height="0dp"` â†’ è¨­å®šé«˜åº¦
   - `app:layout_constraint*` â†’ è¨­å®šç´„æŸæ¢ä»¶

3. å®Œæˆå¾Œç‹€æ…‹
   - GameView æˆç‚ºä¸€å€‹ã€Œåˆæ³•ã€çš„ View
   - å¯ä»¥è¢«åŠ å…¥ View æ¨¹
   - å¯ä»¥è¢«æ¸¬é‡ã€ä½ˆå±€ã€ç¹ªè£½

---

#### æ­¥é©Ÿ 2.3ï¼šåŸ·è¡Œ init()

```java
init();  // ç¬¬ 31 è¡Œ
```

é€²å…¥ `init()` æ–¹æ³•ï¼ˆç¬¬ 39-43 è¡Œï¼‰ï¼š

```java
private void init() {
    carPaint = new Paint();           // ç¬¬ 40 è¡Œ
    carPaint.setColor(Color.RED);     // ç¬¬ 41 è¡Œ
    post(updateRunnable);             // ç¬¬ 42 è¡Œ
}
```

##### æ­¥é©Ÿ 2.3.1ï¼šå»ºç«‹ Paint ç‰©ä»¶

```java
carPaint = new Paint();  // ç¬¬ 40 è¡Œ
```

- å»ºç«‹ç¹ªåœ–ç•«ç­†ç‰©ä»¶
- è³¦å€¼çµ¦æˆå“¡è®Šæ•¸ `carPaint`ï¼ˆå®£å‘Šæ–¼ç¬¬ 12 è¡Œï¼‰

##### æ­¥é©Ÿ 2.3.2ï¼šè¨­å®šç•«ç­†é¡è‰²

```java
carPaint.setColor(Color.RED);  // ç¬¬ 41 è¡Œ
```

- å°‡ç•«ç­†è¨­ç‚ºç´…è‰²ï¼ˆ#FFFF0000ï¼‰

##### æ­¥é©Ÿ 2.3.3ï¼šè¨»å†Šå‹•ç•«ä»»å‹™

```java
post(updateRunnable);  // ç¬¬ 42 è¡Œ
```

- å°‡ `updateRunnable` åŠ å…¥ä¸»åŸ·è¡Œç·’è¨Šæ¯ä½‡åˆ—
- ç­‰å¾… View æº–å‚™å®Œæˆå¾ŒåŸ·è¡Œ

**updateRunnable å®šç¾©**ï¼ˆç¬¬ 16-23 è¡Œï¼‰ï¼š
```java
private final Runnable updateRunnable = new Runnable() {
    @Override
    public void run() {
        update();                // ç¬¬ 19 è¡Œ
        invalidate();            // ç¬¬ 20 è¡Œ
        postDelayed(this, 16);   // ç¬¬ 21 è¡Œï¼ˆ60 FPS = 1000ms Ã· 60 â‰ˆ 16msï¼‰
    }
};
```

---

#### æ­¥é©Ÿ 2.4ï¼šç‰©ä»¶å»ºç«‹å®Œæˆ

```
init() åŸ·è¡Œå®Œç•¢
    â†“
å»ºæ§‹å­åŸ·è¡Œå®Œç•¢
    â†“
returnï¼ˆéš±å«ï¼‰
    â†“
GameView ç‰©ä»¶å»ºç«‹å®Œæˆ âœ“
```

**æ­¤æ™‚ç‰©ä»¶ç‹€æ…‹**ï¼š
- âœ… View åŸºç¤åŠŸèƒ½å·²åˆå§‹åŒ–
- âœ… ID = `R.id.gameView`
- âœ… å¯¬é«˜åƒæ•¸å·²è¨­å®š
- âœ… ç´„æŸæ¢ä»¶å·²è¨­å®š
- âœ… carPaint å·²å»ºç«‹ï¼ˆç´…è‰²ï¼‰
- âœ… å‹•ç•«ä»»å‹™å·²è¨»å†Šï¼ˆç­‰å¾…åŸ·è¡Œï¼‰
- â³ ç­‰å¾…è¢«åŠ å…¥ View æ¨¹

---

## éšæ®µ 3ï¼šView ç”Ÿå‘½é€±æœŸ

### ğŸ“‹ View åŠ å…¥ View æ¨¹å¾Œçš„æµç¨‹

```
GameView ç‰©ä»¶å»ºç«‹å®Œæˆ
    â†“
ç³»çµ±å°‡ GameView åŠ å…¥ View æ¨¹
    â†“
View æ¨¹çµæ§‹ï¼š
    ConstraintLayout (id=main)
        â””â”€â”€ GameView (id=gameView)
    â†“
onAttachedToWindow() â†’ View é™„åŠ åˆ°è¦–çª—
    â†“
onMeasure(widthSpec, heightSpec) â†’ æ¸¬é‡ View å°ºå¯¸
    â†“
onLayout(changed, left, top, right, bottom) â†’ æ±ºå®š View ä½ç½®
    â†“
View æº–å‚™å®Œæˆ âœ“
    â†“
ç³»çµ±åŸ·è¡Œè¨Šæ¯ä½‡åˆ—ä¸­çš„ä»»å‹™ â†’ updateRunnable.run()
```

---

### ğŸ”„ å®Œæ•´ View ç”Ÿå‘½é€±æœŸ

```
å»ºæ§‹å­ï¼ˆç¬¬ 29-32 è¡Œï¼‰
    â†“
onAttachedToWindow()
    â†“
onMeasure()
    â†“
onLayout()
    â†“
onDraw()  â† é¦–æ¬¡ç¹ªè£½
    â†“
ï¼ˆä½¿ç”¨ä¸­ï¼ŒæŒçºŒ onDraw()ï¼‰
    â†“
onDetachedFromWindow()  â† å¾ View æ¨¹ç§»é™¤
```

---

## éšæ®µ 4ï¼šå‹•ç•«å¾ªç’°

### ğŸ”„ å‹•ç•«å¾ªç’°æµç¨‹

```
View æº–å‚™å®Œæˆ
    â†“
åŸ·è¡Œä½‡åˆ—ä¸­çš„ä»»å‹™ï¼šupdateRunnable.run()ï¼ˆç¬¬ 18 è¡Œï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ updateRunnable.run() å…§éƒ¨åŸ·è¡Œ           â”‚
â”‚                                         â”‚
â”‚ 1. update()  ï¼ˆç¬¬ 19 è¡Œï¼‰               â”‚
â”‚    â””â”€ æ›´æ–°éŠæˆ²é‚è¼¯ï¼ˆç›®å‰æ˜¯ç©ºçš„ï¼‰         â”‚
â”‚                                         â”‚
â”‚ 2. invalidate()  ï¼ˆç¬¬ 20 è¡Œï¼‰â­         â”‚
â”‚    â””â”€ è¦æ±‚ç³»çµ±é‡ç¹ª â†’ è§¸ç™¼ onDraw()       â”‚
â”‚                                         â”‚
â”‚ 3. postDelayed(this, 16)  ï¼ˆç¬¬ 21 è¡Œï¼‰  â”‚
â”‚    â””â”€ 16ms å¾Œå†æ¬¡åŸ·è¡Œ run()             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç³»çµ±å‘¼å« onDraw(canvas)ï¼ˆç¬¬ 48-54 è¡Œï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onDraw(Canvas canvas) å…§éƒ¨åŸ·è¡Œ          â”‚
â”‚                                         â”‚
â”‚ 1. super.onDraw(canvas)  ï¼ˆç¬¬ 49 è¡Œï¼‰   â”‚
â”‚    â””â”€ å‘¼å«çˆ¶é¡åˆ¥çš„ onDraw               â”‚
â”‚                                         â”‚
â”‚ 2. canvas.drawColor()  ï¼ˆç¬¬ 50 è¡Œï¼‰     â”‚
â”‚    â””â”€ ç¹ªè£½æ·±ç°è‰²èƒŒæ™¯ RGB(50,50,50)      â”‚
â”‚                                         â”‚
â”‚ 3. canvas.drawRect()  ï¼ˆç¬¬ 51 è¡Œï¼‰      â”‚
â”‚    â””â”€ ç¹ªè£½ç´…è‰²çŸ©å½¢ï¼ˆè»Šå­ï¼‰              â”‚
â”‚        åƒæ•¸ï¼š                            â”‚
â”‚        - å·¦ï¼šcarX                        â”‚
â”‚        - ä¸Šï¼šcarY                        â”‚
â”‚        - å³ï¼šcarX + carWidth (120)       â”‚
â”‚        - ä¸‹ï¼šcarY + carHeight (200)      â”‚
â”‚        - ç•«ç­†ï¼šcarPaintï¼ˆç´…è‰²ï¼‰          â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç•«é¢æ›´æ–°å®Œæˆ
    â†“
ç­‰å¾… 16ms...
    â†“
å†æ¬¡åŸ·è¡Œ updateRunnable.run() â†»
    â†“
ï¼ˆç„¡é™å¾ªç’°ï¼Œç›´åˆ° View è¢«ç§»é™¤ï¼‰
```

---

### ğŸ¨ è¦–è¦ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ·±ç°è‰²èƒŒæ™¯                  â”‚
â”‚ RGB(50, 50, 50)             â”‚
â”‚                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”                â”‚
â”‚     â”‚ ç´…è‰² â”‚ â† è»Šå­          â”‚
â”‚     â”‚ çŸ©å½¢ â”‚ (120Ã—200)       â”‚
â”‚     â”‚      â”‚                 â”‚
â”‚     â”‚      â”‚                 â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### â±ï¸ FPS è¨ˆç®—

```
60 FPSï¼ˆæ¯ç§’ 60 å¹€ï¼‰
= 1000ms Ã· 60
â‰ˆ 16.67ms
â†’ æ¯ 16ms æ›´æ–°ä¸€æ¬¡ç•«é¢
```

---

## å®Œæ•´ç²¾ç´°æµç¨‹åœ–

### ğŸ¬ å¾ setContentView åˆ°å‹•ç•«å¾ªç’°ï¼ˆå®Œæ•´ç‰ˆï¼‰

```
T0: MainActivity.onCreate()
    â†“
T1: setContentView(R.layout.activity_main) â­ è§¸ç™¼é»
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T2: â”‚ ç³»çµ±è§£æ activity_main.xml                      â”‚
    â”‚ â”œâ”€ è®€å– XML æª”æ¡ˆ                                â”‚
    â”‚ â”œâ”€ è§£æ XML çµæ§‹                                â”‚
    â”‚ â””â”€ ç™¼ç¾ <com.example.firstapp.GameView>         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T3: â”‚ ã€éšæ®µ 1ï¼šé¡åˆ¥è¼‰å…¥ã€‘                            â”‚
    â”‚                                                 â”‚
    â”‚ æ­¥é©Ÿ 1.1ï¼šè™•ç† package å®£å‘Šï¼ˆç¬¬ 1 è¡Œï¼‰          â”‚
    â”‚   package com.example.firstapp;                â”‚
    â”‚   â†’ å®Œæ•´åç¨±ï¼šcom.example.firstapp.GameView    â”‚
    â”‚                                                 â”‚
    â”‚ æ­¥é©Ÿ 1.2ï¼šè™•ç† importï¼ˆç¬¬ 3-8 è¡Œï¼‰              â”‚
    â”‚   import android.content.Context;              â”‚
    â”‚   import android.graphics.Canvas;              â”‚
    â”‚   import android.graphics.Color;               â”‚
    â”‚   import android.graphics.Paint;               â”‚
    â”‚   import android.util.AttributeSet;            â”‚
    â”‚   import android.view.View;                    â”‚
    â”‚   â†’ å»ºç«‹åç¨±å°ç…§è¡¨                              â”‚
    â”‚                                                 â”‚
    â”‚ æ­¥é©Ÿ 1.3ï¼šè¼‰å…¥é¡åˆ¥å®šç¾©ï¼ˆç¬¬ 10 è¡Œï¼‰              â”‚
    â”‚   public class GameView extends View           â”‚
    â”‚   â†’ è¼‰å…¥çˆ¶é¡åˆ¥ View                             â”‚
    â”‚   â†’ é©—è­‰ç¹¼æ‰¿é—œä¿‚                                â”‚
    â”‚                                                 â”‚
    â”‚ æ­¥é©Ÿ 1.4ï¼šè¼‰å…¥ä¾è³´é¡åˆ¥                          â”‚
    â”‚   â†’ Viewï¼ˆç«‹å³ï¼‰                                â”‚
    â”‚   â†’ Context, AttributeSetï¼ˆå»ºæ§‹å­å‰ï¼‰          â”‚
    â”‚   â†’ Paint, Colorï¼ˆinit() å‰ï¼‰                  â”‚
    â”‚   â†’ Canvasï¼ˆonDraw() å‰ï¼‰                      â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
T4: é¡åˆ¥è¼‰å…¥å®Œæˆ âœ“
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T5: â”‚ ã€éšæ®µ 2ï¼šç‰©ä»¶å»ºç«‹ã€‘                            â”‚
    â”‚                                                 â”‚
    â”‚ å‘¼å«ï¼šnew GameView(context, attrs)              â”‚
    â”‚                                                 â”‚
    â”‚ å»ºæ§‹å­ 2ï¼ˆç¬¬ 29-32 è¡Œï¼‰                         â”‚
    â”‚   public GameView(Context context,              â”‚
    â”‚                   AttributeSet attrs) {         â”‚
    â”‚       super(context, attrs);  // â† T6          â”‚
    â”‚       init();                  // â† T8          â”‚
    â”‚   }                                             â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T6: â”‚ super(context, attrs)ï¼ˆç¬¬ 30 è¡Œï¼‰               â”‚
    â”‚                                                 â”‚
    â”‚ é€²å…¥ android.view.View å»ºæ§‹å­                   â”‚
    â”‚   â”œâ”€ åˆå§‹åŒ–æ¸¬é‡ç³»çµ±                             â”‚
    â”‚   â”œâ”€ åˆå§‹åŒ–ä½ˆå±€ç³»çµ±                             â”‚
    â”‚   â”œâ”€ åˆå§‹åŒ–ç¹ªè£½ç³»çµ±                             â”‚
    â”‚   â”œâ”€ åˆå§‹åŒ–äº‹ä»¶ç³»çµ±                             â”‚
    â”‚   â”œâ”€ è™•ç† android:id="@+id/gameView"           â”‚
    â”‚   â”œâ”€ è™•ç† android:layout_width="match_parent"  â”‚
    â”‚   â”œâ”€ è™•ç† android:layout_height="0dp"          â”‚
    â”‚   â””â”€ è™•ç† app:layout_constraint*               â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
T7: super() åŸ·è¡Œå®Œæˆ âœ“
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T8: â”‚ init()ï¼ˆç¬¬ 39-43 è¡Œï¼‰                           â”‚
    â”‚                                                 â”‚
    â”‚ private void init() {                           â”‚
    â”‚                                                 â”‚
    â”‚   T8.1: carPaint = new Paint();  ï¼ˆç¬¬ 40 è¡Œï¼‰   â”‚
    â”‚         â†’ å»ºç«‹ç•«ç­†ç‰©ä»¶                           â”‚
    â”‚                                                 â”‚
    â”‚   T8.2: carPaint.setColor(Color.RED);           â”‚
    â”‚         â†’ è¨­å®šç´…è‰²ï¼ˆç¬¬ 41 è¡Œï¼‰                   â”‚
    â”‚                                                 â”‚
    â”‚   T8.3: post(updateRunnable);  ï¼ˆç¬¬ 42 è¡Œï¼‰     â”‚
    â”‚         â†’ å°‡å‹•ç•«ä»»å‹™åŠ å…¥è¨Šæ¯ä½‡åˆ—                 â”‚
    â”‚         â†’ ç­‰å¾… View æº–å‚™å®Œæˆå¾ŒåŸ·è¡Œ               â”‚
    â”‚                                                 â”‚
    â”‚ }                                               â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
T9: init() åŸ·è¡Œå®Œæˆ âœ“
    â†“
T10: å»ºæ§‹å­åŸ·è¡Œå®Œæˆ âœ“
    â†“
T11: GameView ç‰©ä»¶å»ºç«‹å®Œæˆ âœ“
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T12:â”‚ ã€éšæ®µ 3ï¼šView ç”Ÿå‘½é€±æœŸã€‘                       â”‚
    â”‚                                                 â”‚
    â”‚ ç³»çµ±å°‡ GameView åŠ å…¥ View æ¨¹                    â”‚
    â”‚   ConstraintLayout (id=main)                   â”‚
    â”‚       â””â”€â”€ GameView (id=gameView)               â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
T13: onAttachedToWindow() â†’ View é™„åŠ åˆ°è¦–çª—
    â†“
T14: onMeasure() â†’ æ¸¬é‡ View å°ºå¯¸
    â†“
T15: onLayout() â†’ æ±ºå®š View ä½ç½®
    â†“
T16: View æº–å‚™å®Œæˆ âœ“
    â†“
T17: ç³»çµ±åŸ·è¡Œè¨Šæ¯ä½‡åˆ— â†’ updateRunnable.run()
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T18:â”‚ ã€éšæ®µ 4ï¼šå‹•ç•«å¾ªç’°ã€‘                            â”‚
    â”‚                                                 â”‚
    â”‚ updateRunnable.run()ï¼ˆç¬¬ 18-22 è¡Œï¼‰             â”‚
    â”‚                                                 â”‚
    â”‚   @Override                                     â”‚
    â”‚   public void run() {                           â”‚
    â”‚                                                 â”‚
    â”‚     T18.1: update();  ï¼ˆç¬¬ 19 è¡Œï¼‰              â”‚
    â”‚            â†’ æ›´æ–°éŠæˆ²é‚è¼¯ï¼ˆç©ºï¼‰                  â”‚
    â”‚                                                 â”‚
    â”‚     T18.2: invalidate();  ï¼ˆç¬¬ 20 è¡Œï¼‰â­        â”‚
    â”‚            â†’ è¦æ±‚ç³»çµ±é‡ç¹ª                        â”‚
    â”‚            â†’ è§¸ç™¼ onDraw()                       â”‚
    â”‚                                                 â”‚
    â”‚     T18.3: postDelayed(this, 16);  ï¼ˆç¬¬ 21 è¡Œï¼‰ â”‚
    â”‚            â†’ 16ms å¾Œå†æ¬¡åŸ·è¡Œ                     â”‚
    â”‚                                                 â”‚
    â”‚   }                                             â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T19:â”‚ onDraw(Canvas canvas)ï¼ˆç¬¬ 48-54 è¡Œï¼‰            â”‚
    â”‚                                                 â”‚
    â”‚ @Override                                       â”‚
    â”‚ protected void onDraw(Canvas canvas) {          â”‚
    â”‚                                                 â”‚
    â”‚   T19.1: super.onDraw(canvas);  ï¼ˆç¬¬ 49 è¡Œï¼‰    â”‚
    â”‚          â†’ å‘¼å«çˆ¶é¡åˆ¥                            â”‚
    â”‚                                                 â”‚
    â”‚   T19.2: canvas.drawColor(                      â”‚
    â”‚              Color.rgb(50, 50, 50));            â”‚
    â”‚          â†’ ç¹ªè£½æ·±ç°è‰²èƒŒæ™¯ï¼ˆç¬¬ 50 è¡Œï¼‰            â”‚
    â”‚                                                 â”‚
    â”‚   T19.3: canvas.drawRect(                       â”‚
    â”‚              carX,                 // å·¦         â”‚
    â”‚              carY,                 // ä¸Š         â”‚
    â”‚              carX + carWidth,      // å³         â”‚
    â”‚              carY + carHeight,     // ä¸‹         â”‚
    â”‚              carPaint);            // ç´…è‰²       â”‚
    â”‚          â†’ ç¹ªè£½ç´…è‰²çŸ©å½¢ï¼ˆç¬¬ 51 è¡Œï¼‰              â”‚
    â”‚                                                 â”‚
    â”‚ }                                               â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
T20: ç•«é¢æ›´æ–°å®Œæˆ âœ“
    â†“
T21: ç­‰å¾… 16ms...
    â†“
T22: å†æ¬¡åŸ·è¡Œ updateRunnable.run() â†’ å›åˆ° T18 â†»
    â†“
    ï¼ˆç„¡é™å¾ªç’°ï¼Œç›´åˆ° View è¢«ç§»é™¤ï¼‰
```

---

### â±ï¸ æ™‚é–“è»¸ï¼ˆæ¯«ç§’ç´šä¼°è¨ˆï¼‰

| æ™‚é–“ | éšæ®µ | äº‹ä»¶ | è¡Œè™Ÿ |
|------|------|------|------|
| 0 ms | è§¸ç™¼ | setContentView() é–‹å§‹ | MainActivity:16 |
| 1 ms | éšæ®µ 1 | è§£æ XML | - |
| 1 ms | éšæ®µ 1 | é¡åˆ¥è¼‰å…¥é–‹å§‹ | 1-10 |
| 2 ms | éšæ®µ 1 | é¡åˆ¥è¼‰å…¥å®Œæˆ | - |
| 2 ms | éšæ®µ 2 | å‘¼å«å»ºæ§‹å­ | 29 |
| 2.1 ms | éšæ®µ 2 | super() åŸ·è¡Œ | 30 |
| 2.5 ms | éšæ®µ 2 | init() é–‹å§‹ | 39 |
| 2.6 ms | éšæ®µ 2 | new Paint() | 40 |
| 2.7 ms | éšæ®µ 2 | setColor(RED) | 41 |
| 2.8 ms | éšæ®µ 2 | post(updateRunnable) | 42 |
| 3 ms | éšæ®µ 2 | ç‰©ä»¶å»ºç«‹å®Œæˆ | - |
| 4 ms | éšæ®µ 3 | onAttachedToWindow() | - |
| 4.5 ms | éšæ®µ 3 | onMeasure() | - |
| 5 ms | éšæ®µ 3 | onLayout() | - |
| 5.5 ms | éšæ®µ 3 | View æº–å‚™å®Œæˆ | - |
| 6 ms | éšæ®µ 4 | updateRunnable.run() | 18 |
| 6.1 ms | éšæ®µ 4 | update() | 19 |
| 6.2 ms | éšæ®µ 4 | invalidate() | 20 |
| 6.3 ms | éšæ®µ 4 | onDraw() é–‹å§‹ | 48 |
| 6.4 ms | éšæ®µ 4 | drawColor() | 50 |
| 6.5 ms | éšæ®µ 4 | drawRect() | 51 |
| 7 ms | éšæ®µ 4 | ç•«é¢æ›´æ–°å®Œæˆ | - |
| 7 ms | éšæ®µ 4 | postDelayed(16) | 21 |
| 23 ms | éšæ®µ 4 | å†æ¬¡åŸ·è¡Œ run() â†» | 18 |

---

## é—œéµæ¦‚å¿µèªªæ˜

### 1. é¡åˆ¥è¼‰å…¥ vs ç‰©ä»¶å»ºç«‹

**é¡åˆ¥è¼‰å…¥ï¼ˆåªç™¼ç”Ÿä¸€æ¬¡ï¼‰**ï¼š
```
ç¬¬ä¸€æ¬¡ä½¿ç”¨ GameView æ™‚
    â†“
è¼‰å…¥ GameView.class
    â”œâ”€ è™•ç† package
    â”œâ”€ è™•ç† import
    â”œâ”€ è¼‰å…¥é¡åˆ¥å®šç¾©
    â””â”€ è¼‰å…¥ä¾è³´é¡åˆ¥
    â†“
GameView.class å­˜å…¥è¨˜æ†¶é«” âœ“
```

**ç‰©ä»¶å»ºç«‹ï¼ˆå¯å¤šæ¬¡ï¼‰**ï¼š
```
æ¯æ¬¡ new GameView() æ™‚
    â†“
é¡åˆ¥å·²åœ¨è¨˜æ†¶é«”ï¼ˆè·³éè¼‰å…¥ï¼‰
    â†“
ç›´æ¥å‘¼å«å»ºæ§‹å­
    â”œâ”€ super()
    â””â”€ init()
    â†“
å»ºç«‹æ–°çš„ GameView ç‰©ä»¶ âœ“
```

---

### 2. super() çš„ä½œç”¨

```java
public GameView(Context context, AttributeSet attrs) {
    super(context, attrs);  // â† ç‚ºä»€éº¼å¿…é ˆç¬¬ä¸€è¡Œï¼Ÿ
    init();
}
```

**åŸå› **ï¼š
- Java è¦å®šï¼šå­é¡åˆ¥å»ºæ§‹å­å¿…é ˆå…ˆå‘¼å«çˆ¶é¡åˆ¥å»ºæ§‹å­
- ç¢ºä¿çˆ¶é¡åˆ¥å·²æ­£ç¢ºåˆå§‹åŒ–
- å­é¡åˆ¥æ‰èƒ½å®‰å…¨ä½¿ç”¨ç¹¼æ‰¿çš„åŠŸèƒ½

**ç¹¼æ‰¿éˆ**ï¼š
```
GameView
    extends View
        extends Object
```

**åˆå§‹åŒ–é †åº**ï¼š
```
Object å»ºæ§‹å­
    â†“
View å»ºæ§‹å­
    â†“
GameView å»ºæ§‹å­
```

---

### 3. init() æ–¹æ³•çš„è¨­è¨ˆæ¨¡å¼

**ç‚ºä»€éº¼ä½¿ç”¨ init()**ï¼š

```java
// âŒ ä¸å¥½ï¼šé‡è¤‡ç¨‹å¼ç¢¼
public GameView(Context context) {
    super(context);
    carPaint = new Paint();
    carPaint.setColor(Color.RED);
    post(updateRunnable);
}

public GameView(Context context, AttributeSet attrs) {
    super(context, attrs);
    carPaint = new Paint();        // é‡è¤‡
    carPaint.setColor(Color.RED);  // é‡è¤‡
    post(updateRunnable);          // é‡è¤‡
}

// âœ… å¥½ï¼šçµ±ä¸€åˆå§‹åŒ–
public GameView(Context context) {
    super(context);
    init();  // å…±ç”¨é‚è¼¯
}

public GameView(Context context, AttributeSet attrs) {
    super(context, attrs);
    init();  // å…±ç”¨é‚è¼¯
}

private void init() {
    carPaint = new Paint();
    carPaint.setColor(Color.RED);
    post(updateRunnable);
}
```

**å„ªé»**ï¼š
1. ç¨‹å¼ç¢¼é‡ç”¨ï¼šä¸‰å€‹å»ºæ§‹å­éƒ½å‘¼å«åŒä¸€å€‹ init()
2. æ˜“æ–¼ç¶­è­·ï¼šåˆå§‹åŒ–é‚è¼¯é›†ä¸­åœ¨ä¸€è™•
3. æ¸…æ™°æ˜“è®€ï¼šå»ºæ§‹å­ç°¡æ½”ï¼Œé‚è¼¯åˆ†é›¢

---

### 4. post() èˆ‡ Runnable

```java
post(updateRunnable);
```

**ç‚ºä»€éº¼ä¸ç›´æ¥å‘¼å«**ï¼š

```java
// âŒ ä¸è¡Œ
updateRunnable.run();  // åœ¨å»ºæ§‹å­ä¸­åŸ·è¡Œå¤ªæ—©

// âœ… æ­£ç¢º
post(updateRunnable);  // ç­‰ View æº–å‚™å¥½å¾ŒåŸ·è¡Œ
```

**æ™‚é–“å·®**ï¼š
```
å»ºæ§‹å­åŸ·è¡Œæ™‚ï¼šView é‚„æ²’åŠ å…¥ View æ¨¹
    â†“
post() å°‡ä»»å‹™åŠ å…¥ä½‡åˆ—
    â†“
å»ºæ§‹å­çµæŸ
    â†“
View åŠ å…¥ View æ¨¹
    â†“
onMeasure(), onLayout()
    â†“
View æº–å‚™å®Œæˆ
    â†“
ç³»çµ±åŸ·è¡Œä½‡åˆ—ä¸­çš„ä»»å‹™
    â†“
updateRunnable.run() è¢«å‘¼å« âœ“
```

---

### 5. invalidate() çš„ä½œç”¨

```java
invalidate();  // ç¬¬ 20 è¡Œ
```

**åŠŸèƒ½**ï¼šè¦æ±‚ç³»çµ±é‡ç¹ª View

**æµç¨‹**ï¼š
```
invalidate() è¢«å‘¼å«
    â†“
ç³»çµ±æ¨™è¨˜ View ç‚ºã€Œéœ€è¦é‡ç¹ªã€
    â†“
ç­‰å¾…ä¸‹ä¸€å€‹ç¹ªè£½é€±æœŸ
    â†“
ç³»çµ±å‘¼å« onDraw(canvas)
    â†“
ç•«é¢æ›´æ–°
```

**ä½•æ™‚ä½¿ç”¨**ï¼š
- è³‡æ–™æ”¹è®Šï¼Œéœ€è¦æ›´æ–°ç•«é¢
- å‹•ç•«æ›´æ–°
- ä½¿ç”¨è€…äº’å‹•å¾Œéœ€è¦é‡ç¹ª

---

### 6. AttributeSet çš„ä½œç”¨

**AttributeSet æ˜¯ä»€éº¼**ï¼š
- åŒ…å« XML ä¸­æ‰€æœ‰å±¬æ€§çš„é›†åˆ
- ç”±ç³»çµ±è‡ªå‹•å»ºç«‹
- å‚³éçµ¦å»ºæ§‹å­

**ç¯„ä¾‹**ï¼š
```xml
<com.example.firstapp.GameView
    android:id="@+id/gameView"           â† attrs åŒ…å«
    android:layout_width="match_parent"  â† attrs åŒ…å«
    android:layout_height="0dp"          â† attrs åŒ…å«
    app:layout_constraint*="..."         â† attrs åŒ…å«
/>
```

**åœ¨å»ºæ§‹å­ä¸­**ï¼š
```java
public GameView(Context context, AttributeSet attrs) {
    super(context, attrs);  // â† å‚³çµ¦çˆ¶é¡åˆ¥è™•ç†
    // çˆ¶é¡åˆ¥æœƒè§£æ attrs ä¸¦å¥—ç”¨å±¬æ€§
}
```

---

### 7. äº‹ä»¶å¾ªç’°ï¼ˆä¸æ˜¯ã€Œåœåœ¨ç•«é¢ã€ï¼‰

**éŒ¯èª¤ç†è§£**ï¼š
```
setContentView() åŸ·è¡Œå®Œç•¢
    â†“
ç¨‹å¼åœåœ¨ç•«é¢ç­‰å¾…
```

**æ­£ç¢ºç†è§£**ï¼š
```
setContentView() åŸ·è¡Œå®Œç•¢
    â†“
é€²å…¥äº‹ä»¶å¾ªç’°
    â†“
æŒçºŒè™•ç†å„ç¨®äº‹ä»¶ï¼š
    - å‹•ç•«æ›´æ–°ï¼ˆupdateRunnableï¼‰
    - è§¸æ§äº‹ä»¶ï¼ˆonTouchEventï¼‰
    - ç”Ÿå‘½é€±æœŸäº‹ä»¶ï¼ˆonPause, onResumeï¼‰
    - ç³»çµ±äº‹ä»¶
    - ç­‰ç­‰...
```

---

### 8. åŸ·è¡Œé »ç‡å·®ç•°

| æ–¹æ³• | åŸ·è¡Œé »ç‡ | èªªæ˜ |
|------|---------|------|
| å»ºæ§‹å­ | åªåŸ·è¡Œä¸€æ¬¡ | ç‰©ä»¶å»ºç«‹æ™‚ |
| init() | åªåŸ·è¡Œä¸€æ¬¡ | å»ºæ§‹å­ä¸­å‘¼å« |
| update() | æ¯ 16ms åŸ·è¡Œä¸€æ¬¡ | å‹•ç•«å¾ªç’° |
| onDraw() | æ¯ 16ms åŸ·è¡Œä¸€æ¬¡ | invalidate() è§¸ç™¼ |
| onMeasure() | å°ºå¯¸æ”¹è®Šæ™‚ | è¢å¹•æ—‹è½‰ç­‰ |
| onLayout() | ä½ç½®æ”¹è®Šæ™‚ | çˆ¶å®¹å™¨èª¿æ•´ç­‰ |

---

## ç¸½çµ

### âœ… å››å¤§éšæ®µå›é¡§

| éšæ®µ | è§¸ç™¼æ™‚æ©Ÿ | ä¸»è¦å‹•ä½œ | ç™¼ç”Ÿæ¬¡æ•¸ |
|------|---------|---------|---------|
| 1. é¡åˆ¥è¼‰å…¥ | setContentView() | è¼‰å…¥ .class æª”æ¡ˆ | åªç™¼ç”Ÿä¸€æ¬¡ |
| 2. ç‰©ä»¶å»ºç«‹ | new GameView() | å‘¼å«å»ºæ§‹å­ | å¯å¤šæ¬¡ |
| 3. View ç”Ÿå‘½é€±æœŸ | åŠ å…¥ View æ¨¹ | onMeasure, onLayout | å¿…è¦æ™‚ |
| 4. å‹•ç•«å¾ªç’° | post(updateRunnable) | update, onDraw | æ¯ 16ms |

---

### ğŸ¯ é—œéµè¦é»

| æ¦‚å¿µ | èªªæ˜ |
|------|------|
| XML â†’ ç‰©ä»¶ | ç³»çµ±è‡ªå‹•è½‰æ› XML æ¨™ç±¤ç‚ºå»ºæ§‹å­å‘¼å« |
| å»ºæ§‹å­é¸æ“‡ | XML è¼‰å…¥ä½¿ç”¨é›™åƒæ•¸å»ºæ§‹å­ |
| åˆå§‹åŒ–é †åº | super() â†’ init() |
| å‹•ç•«æ©Ÿåˆ¶ | post() + Runnable + invalidate() + onDraw() |
| ç¹ªè£½è§¸ç™¼ | invalidate() è§¸ç™¼ onDraw() |
| äº‹ä»¶å¾ªç’° | ä¸æ˜¯åœåœ¨ç•«é¢ï¼Œè€Œæ˜¯æŒçºŒè™•ç†äº‹ä»¶ |

---

### ğŸ”— ç›¸é—œæª”æ¡ˆ

| æª”æ¡ˆ | èªªæ˜ |
|------|------|
| `MainActivity.java` | å‘¼å« setContentView |
| `activity_main.xml` | å®šç¾© GameView æ¨™ç±¤ |
| `GameView.java` | è‡ªè¨‚ View å¯¦ä½œ |
| `TTTT.md` | MainActivity è©³è§£ |
| `TTT.md` | AndroidManifest è©³è§£ |
| `Rok.md` | R è³‡æºè¦å‰‡è©³è§£ |

---

**ğŸ“… æ–‡ä»¶ç‰ˆæœ¬**ï¼šv2.0
**ğŸ‘¤ é©ç”¨å°è±¡**ï¼šAndroid åˆå­¸è€…
**ğŸ’¡ å»ºè­°**ï¼šæ­é…å¯¦éš›åŸ·è¡Œé™¤éŒ¯è§€å¯Ÿæµç¨‹

---

## æ›´æ–°è¨˜éŒ„

### v2.0 (2025/12/08)
- å®Œå…¨é‡æ§‹æ–‡ä»¶æ¶æ§‹
- é–‹é ­æä¾›å®Œæ•´æµç¨‹ç¸½è¦½
- ä¾éšæ®µåˆ†å±¤è©³ç´°è§£èªª
- çµå°¾æä¾›ç²¾ç´°çµ±æ•´æµç¨‹åœ–
- æ¶ˆé™¤é‡è¤‡å…§å®¹
- æ”¹å–„æµç¨‹åœ–å¯è®€æ€§
- æ–°å¢å®Œæ•´æ™‚é–“è»¸è¡¨æ ¼

### v1.3 (2025/12/08)
- ç§»é™¤é‡è¤‡å…§å®¹
- å„ªåŒ–é¡åˆ¥è¼‰å…¥éšæ®µèªªæ˜
- ä¿®æ­£ç¨‹å¼ç¢¼ç¸®æ’å•é¡Œ
- ç²¾ç°¡æ–‡å­—ï¼Œæé«˜å¯è®€æ€§

### v1.2 (2025/12/08)
- æ–°å¢å®Œæ•´ç¨‹å¼ç¢¼
- è£œå……æˆå“¡è®Šæ•¸èªªæ˜
- å¢å¼· updateRunnable èªªæ˜
- å®Œæ•´è§£æ onDraw() æ–¹æ³•

### v1.1 (2025/12/08)
- æ–°å¢é¡åˆ¥è¼‰å…¥éšæ®µç« ç¯€
- è©³ç´°èªªæ˜ package å’Œ import è™•ç†æ™‚æ©Ÿ
- è£œå……é¡åˆ¥è¼‰å…¥ vs ç‰©ä»¶å»ºç«‹å·®ç•°

### v1.0 (2025/12/08)
- åˆå§‹ç‰ˆæœ¬å»ºç«‹
